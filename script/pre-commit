#!/bin/sh
#
# An example hook script to verify what is about to be committed.
# Called by "git commit" with no arguments.  The hook should
# exit with non-zero status after issuing an appropriate message if
# it wants to stop the commit.
#
# To enable this hook, rename this file to "pre-commit".

echo "Test 1: Checking linting for all changed js|vue files..."

lint_folder="./resources"

changed_files=$(git diff --cached --name-only --diff-filter=ACM "$lint_folder" | grep -E '\.(js|vue)$')

if [ -n "$changed_files" ]; then
    npm run lint:js -- $changed_files

    # If lint fails, exit with non-zero status
    if [ $? -ne 0 ]; then
        echo "lint hook failed"
        exit 1
    fi
fi

echo "js|vue lint hook was successful"

echo "Test 2: Checking linting for all changed css|scss|vue files..."

css_lint_folder="./resources"

css_changed_files=$(git diff --cached --name-only --diff-filter=ACM "$css_lint_folder" | grep -E '\.(css|scss|vue)$')

if [ -n "$css_changed_files" ]; then
    npm run lint:css -- $css_changed_files

    # If lint fails, exit with non-zero status
    if [ $? -ne 0 ]; then
        echo "lint hook failed"
        exit 1
    fi
fi

echo "css|scss|vue lint hook was successful"

resources="./resources"
changed_resources=$(git diff --cached --name-only --diff-filter=ACM "$resources")


if [ -n "$changed_resources" ]; then
    echo "Test 2: Building Project..."
    npm run build
    if [ $? -ne 0 ]; then
        echo "project build hook failed"
        exit 1
    fi
    echo "link hook was successful"
fi

